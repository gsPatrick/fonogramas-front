{% extends "usuario/base_usuario.html" %}

{% block page_title %}Meus Fonogramas{% endblock %}

{% block usuario_content %}
<!-- Stats Cards Modernos -->
<div class="stats-grid-modern mb-4">
    <div class="stats-card stats-card--total">
        <i class="bi bi-music-note-list stats-card__icon"></i>
        <div class="stats-card__value">{{ stats.total }}</div>
        <div class="stats-card__label">Total Cadastrado</div>
    </div>
    <div class="stats-card stats-card--pendente">
        <i class="bi bi-hourglass-split stats-card__icon"></i>
        <div class="stats-card__value">{{ stats.nao_enviados if stats.nao_enviados is defined else stats.pendentes }}
        </div>
        <div class="stats-card__label">Não Enviados</div>
    </div>
    <div class="stats-card stats-card--enviado">
        <i class="bi bi-send stats-card__icon"></i>
        <div class="stats-card__value">{{ stats.enviados if stats.enviados is defined else 0 }}</div>
        <div class="stats-card__label">Enviados</div>
    </div>
    <div class="stats-card stats-card--aceito">
        <i class="bi bi-check-circle stats-card__icon"></i>
        <div class="stats-card__value">{{ stats.aceitos }}</div>
        <div class="stats-card__label">Aceitos ECAD</div>
    </div>
    <div class="stats-card stats-card--recusado">
        <i class="bi bi-x-circle stats-card__icon"></i>
        <div class="stats-card__value">{{ stats.recusados if stats.recusados is defined else 0 }}</div>
        <div class="stats-card__label">Recusados</div>
    </div>
</div>

<!-- Card de Últimos Envios -->
<div class="form-section">
    <div class="form-section__title">
        <i class="bi bi-clock-history"></i>
        <span>Últimos Envios</span>
        <a href="{{ url_for('usuario.novo_fonograma') }}" class="btn-sbacem btn-sbacem--primary btn-sbacem--sm ms-auto">
            <i class="bi bi-plus-lg"></i> Novo Fonograma
        </a>
    </div>

    {% if recentes %}
    <div class="table-responsive">
        <table class="table-modern table-cards">
            <thead>
                <tr>
                    <th>ISRC</th>
                    <th>Título</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for f in recentes %}
                <tr>
                    <td data-label="ISRC">
                        <code style="color: var(--sbacem-roxo);">{{ f.isrc }}</code>
                    </td>
                    <td data-label="Título" class="text-truncate-mobile">{{ f.titulo }}</td>
                    <td data-label="Status">
                        {% set status = f.status_ecad or 'NAO_ENVIADO' %}
                        <span class="badge-status badge-status--{{ status|lower|replace(' ', '_') }}">
                            <i class="bi bi-circle-fill"></i>
                            {{ status|replace('_', ' ') }}
                        </span>
                    </td>
                    <td data-label="Ações" class="td-actions">
                        <a href="{{ url_for('usuario.detalhes_fonograma', fonograma_id=f.id) }}"
                            class="btn-sbacem btn-sbacem--secondary btn-sbacem--sm">
                            <i class="bi bi-eye"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-music-note-list" style="font-size: 3rem; color: var(--sbacem-bege);"></i>
        <p class="text-muted mt-3">Nenhum fonograma cadastrado ainda.</p>
        <a href="{{ url_for('usuario.novo_fonograma') }}" class="btn-sbacem btn-sbacem--primary mt-2">
            <i class="bi bi-plus-lg"></i> Cadastrar Primeiro Fonograma
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}