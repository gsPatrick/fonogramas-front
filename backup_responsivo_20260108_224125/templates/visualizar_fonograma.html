<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizar Fonograma - FONOGRAMA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <img src="{{ url_for('static', filename='assets/logo.svg') }}" alt="Logo" class="logo-icon">
                    <div class="logo-text-container">
                        <div class="logo-text">FONOGRAMA</div>
                        <div class="logo-tagline">Sistema de Gestão ECAD/ABRAMUS</div>
                    </div>
                </div>
            </div>
        </header>

        <nav class="main-nav">
            <a href="/" class="nav-link">Início</a>
            <a href="/fonogramas" class="nav-link">Listar Fonogramas</a>
            <a href="/fonogramas/novo" class="nav-link">Novo Fonograma</a>
            <a href="/estatisticas" class="nav-link">Estatísticas</a>
        </nav>

        <main>
            <div class="list-section">
                <div class="list-header">
                    <h2>Visualizar Fonograma</h2>
                </div>

                <div id="fonogramaDetails" class="loading">
                    Carregando dados do fonograma...
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <p class="footer-title">Sistema de Processamento de Fonogramas</p>
                <p class="footer-org">ECAD / ABRAMUS</p>
                <p class="footer-version">Versão 1.0</p>
            </div>
        </footer>
    </div>

    <script>
        const fonogramaId = {{ fonograma_id }};

        async function carregarFonograma() {
            try {
                const res = await fetch(`/api/v1/fonogramas/${fonogramaId}`);
                const response = await res.json();
                
                if (!response.success) {
                    throw new Error(response.error || 'Erro ao carregar fonograma');
                }
                
                const fonograma = response.data;
                renderizarFonograma(fonograma);
            } catch (err) {
                document.getElementById('fonogramaDetails').innerHTML = `
                    <div class="error">
                        <p>Erro ao carregar fonograma: ${err.message}</p>
                        <button class="btn-secondary" onclick="window.location.href='/fonogramas'">Voltar para Listagem</button>
                    </div>
                `;
            }
        }

        function renderizarFonograma(f) {
            const html = `
                <div class="info-section">
                    <div class="info-card">
                        <h3>Identificação</h3>
                        <p><strong>ISRC:</strong> ${f.isrc || '-'}</p>
                        <p><strong>Título:</strong> ${f.titulo || '-'}</p>
                        <p><strong>Versão:</strong> ${f.versao || '-'}</p>
                        <p><strong>Duração:</strong> ${f.duracao || '-'}</p>
                        <p><strong>Gênero:</strong> ${f.genero || '-'}</p>
                        <p><strong>Idioma:</strong> ${f.idioma || '-'}</p>
                    </div>

                    <div class="info-card">
                        <h3>Obra Musical</h3>
                        <p><strong>Título da Obra:</strong> ${f.titulo_obra || '-'}</p>
                        <p><strong>Código da Obra:</strong> ${f.cod_obra || '-'}</p>
                    </div>

                    <div class="info-card">
                        <h3>Produtor</h3>
                        <p><strong>Nome:</strong> ${f.prod_nome || '-'}</p>
                        <p><strong>Documento:</strong> ${f.prod_doc || '-'}</p>
                        <p><strong>Percentual:</strong> ${f.prod_perc || 0}%</p>
                    </div>

                    <div class="info-card">
                        <h3>Lançamento</h3>
                        <p><strong>Ano de Gravação:</strong> ${f.ano_grav || '-'}</p>
                        <p><strong>Ano de Lançamento:</strong> ${f.ano_lanc || '-'}</p>
                        <p><strong>Álbum:</strong> ${f.album || '-'}</p>
                        <p><strong>Selo:</strong> ${f.selo || '-'}</p>
                    </div>

                    <div class="info-card">
                        <h3>Status</h3>
                        <p><strong>Situação:</strong> <span class="badge badge-${(f.situacao || 'ATIVO').toLowerCase()}">${f.situacao || 'ATIVO'}</span></p>
                        <p><strong>Status ECAD:</strong> <span class="badge badge-${(f.status_ecad || 'NAO_ENVIADO').toLowerCase()}">${f.status_ecad || 'NAO_ENVIADO'}</span></p>
                        <p><strong>Tentativas de Envio:</strong> ${f.tentativas_envio || 0}</p>
                        <p><strong>Último Protocolo:</strong> ${f.ultimo_protocolo_ecad || '-'}</p>
                    </div>

                    <div class="info-card">
                        <h3>Autores</h3>
                        ${f.autores && f.autores.length > 0 ? 
                            f.autores.map(a => `
                                <p><strong>${a.nome}</strong> (${a.funcao}) - ${a.percentual}%</p>
                            `).join('') : 
                            '<p>Nenhum autor cadastrado</p>'
                        }
                    </div>
                </div>

                <div class="actions-section" style="text-align: center; margin-top: 30px;">
                    <button class="btn-primary" onclick="window.location.href='/fonogramas/${f.id}/editar'">Editar Fonograma</button>
                    <button class="btn-secondary" onclick="window.location.href='/fonogramas'">Voltar para Listagem</button>
                </div>
            `;

            document.getElementById('fonogramaDetails').innerHTML = html;
        }

        // Carregar ao iniciar
        carregarFonograma();
    </script>
</body>
</html>
