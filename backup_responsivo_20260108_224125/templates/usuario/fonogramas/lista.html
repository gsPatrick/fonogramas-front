{% extends "usuario/base_usuario.html" %}

{% block page_title %}Meus Fonogramas{% endblock %}

{% block page_actions %}
<a href="{{ url_for('usuario.dashboard') }}" class="btn-sbacem btn-sbacem--secondary btn-sbacem--sm me-2">
    <i class="bi bi-arrow-left"></i> Voltar
</a>
<a href="{{ url_for('usuario.novo_fonograma') }}" class="btn-sbacem btn-sbacem--success btn-sbacem--sm">
    <i class="bi bi-plus-lg"></i> Novo
</a>
{% endblock %}

{% block usuario_content %}
<div class="form-section">
    <!-- Filtros -->
    <form class="row g-3 mb-4" method="GET">
        <div class="col-md-5">
            <input type="text" class="form-control form-control-modern" name="busca"
                placeholder="Buscar por ISRC, Título..." value="{{ request.args.get('busca', '') }}">
        </div>
        <div class="col-md-4">
            <select class="form-select form-control-modern" name="genero">
                <option value="">Todos Gêneros</option>
                <option value="Sertanejo">Sertanejo</option>
                <option value="Pop">Pop</option>
                <option value="Rock">Rock</option>
                <option value="MPB">MPB</option>
                <option value="Forró">Forró</option>
            </select>
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn-sbacem btn-sbacem--primary w-100">
                <i class="bi bi-search"></i> Filtrar
            </button>
        </div>
    </form>

    <!-- Tabela de Fonogramas -->
    <div class="table-responsive">
        <table class="table-modern">
            <thead>
                <tr>
                    <th>ISRC</th>
                    <th>Título</th>
                    <th>Versão</th>
                    <th>Duração</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for f in fonogramas.items %}
                <tr>
                    <td data-label="ISRC">
                        <code style="color: var(--sbacem-roxo); font-weight: 600;">{{ f.isrc }}</code>
                    </td>
                    <td data-label="Título">
                        <strong>{{ f.titulo }}</strong>
                    </td>
                    <td data-label="Versão">{{ f.versao or '-' }}</td>
                    <td data-label="Duração">{{ f.duracao }}</td>
                    <td data-label="Status">
                        {% set status = f.status_ecad or 'NAO_ENVIADO' %}
                        <span class="badge-status badge-status--{{ status|lower|replace(' ', '_') }}">
                            <i class="bi bi-circle-fill"></i>
                            {{ status|replace('_', ' ') }}
                        </span>
                    </td>
                    <td data-label="Ações">
                        <div class="d-flex gap-1">
                            <a href="{{ url_for('usuario.detalhes_fonograma', fonograma_id=f.id) }}"
                                class="btn-sbacem btn-sbacem--secondary btn-sbacem--sm" title="Ver">
                                <i class="bi bi-eye"></i>
                            </a>
                            {% if status not in ['ENVIADO', 'ACEITO'] %}
                            <a href="{{ url_for('usuario.editar_fonograma', fonograma_id=f.id) }}"
                                class="btn-sbacem btn-sbacem--ghost btn-sbacem--sm" title="Editar">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <form action="{{ url_for('usuario.excluir_fonograma', fonograma_id=f.id) }}" method="POST"
                                style="display: inline;"
                                onsubmit="return confirm('Tem certeza que deseja excluir o fonograma {{ f.isrc }}?');">
                                <button type="submit" class="btn-sbacem btn-sbacem--danger btn-sbacem--sm"
                                    title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <i class="bi bi-music-note-list" style="font-size: 3rem; color: var(--sbacem-bege);"></i>
                        <p class="text-muted mt-3">Nenhum fonograma encontrado.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginação Moderna -->
    {% if fonogramas.pages > 1 %}
    <nav class="mt-4">
        <div class="pagination-modern">
            <a class="pagination-modern__item {{ 'pagination-modern__item--disabled' if not fonogramas.has_prev }}"
                href="{{ url_for('usuario.listar_fonogramas', page=fonogramas.prev_num) if fonogramas.has_prev else '#' }}">
                <i class="bi bi-chevron-left"></i>
            </a>
            {% for page_num in fonogramas.iter_pages() %}
            {% if page_num %}
            <a class="pagination-modern__item {{ 'pagination-modern__item--active' if page_num == fonogramas.page }}"
                href="{{ url_for('usuario.listar_fonogramas', page=page_num) }}">
                {{ page_num }}
            </a>
            {% else %}
            <span class="pagination-modern__item pagination-modern__item--disabled">...</span>
            {% endif %}
            {% endfor %}
            <a class="pagination-modern__item {{ 'pagination-modern__item--disabled' if not fonogramas.has_next }}"
                href="{{ url_for('usuario.listar_fonogramas', page=fonogramas.next_num) if fonogramas.has_next else '#' }}">
                <i class="bi bi-chevron-right"></i>
            </a>
        </div>
    </nav>
    {% endif %}
</div>
{% endblock usuario_content %}