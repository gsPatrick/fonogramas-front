{% extends "admin/base_admin.html" %}

{% block page_title %}Resultado da Validação{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-body">
        <div class="row text-center">
            <div class="col-md-3">
                <h3 class="text-primary">{{ resultado.total_linhas }}</h3>
                <small class="text-muted">Total de Linhas</small>
            </div>
            <div class="col-md-3">
                <h3 class="text-success">{{ resultado.linhas_validas }}</h3>
                <small class="text-muted">Válidos</small>
            </div>
            <div class="col-md-3">
                <h3 class="text-danger">{{ resultado.linhas_com_erro }}</h3>
                <small class="text-muted">Com Erros</small>
            </div>
            <div class="col-md-3">
                <div class="d-grid">
                    {% if resultado.linhas_validas > 0 %}
                    <form method="POST" enctype="multipart/form-data">
                        <!-- Precisaríamos re-enviar o arquivo ou usar sessão. 
                             Simplificação: Assumindo que o controller lida com isso ou pede re-upload.
                             No código atual (lote_service), ele espera o arquivo novamente no modo 'salvar' ou 
                             usa um caminho temporário. 
                             Vamos assumir um botão de voltar para corrigir se houver erros, 
                             ou um botão para confirmar se for robusto.
                             
                             Entretanto, a rota 'importar_lote' POST espera 'arquivo' novamente se modo='salvar'.
                             Isso é uma limitação do backend atual sem sessão de arquivo.
                             Vou colocar apenas um botão de Nova Importação para simplificar.
                        -->
                        <a href="{{ url_for('admin.importar_lote') }}" class="btn btn-primary">Nova Importação /
                            Confirmar</a>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% if resultado.erros %}
<div class="card">
    <div class="card-header bg-danger text-white">Relatório de Erros</div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-sm table-striped">
                <thead>
                    <tr>
                        <th>Linha</th>
                        <th>Erro</th>
                        <th>Dados</th>
                    </tr>
                </thead>
                <tbody>
                    {% for erro in resultado.erros %}
                    <tr>
                        <td>{{ erro.linha }}</td>
                        <td class="text-danger">{{ erro.erro }}</td>
                        <td><small class="text-muted">{{ erro.dados }}</small></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}